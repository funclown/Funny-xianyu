# 闲鱼爬虫系统 - 部署方式对比

## 🎯 推荐方案速览

| 部署方式 | 难度 | 适用场景 | 优点 | 缺点 |
|---------|------|---------|------|------|
| **🥇 一键安装脚本** | ⭐ 极简单 | 新手、快速部署 | 自动安装所有依赖 | 需要 Python 环境 |
| **🥈 Docker 容器** | ⭐⭐ 简单 | 服务器、隔离环境 | 环境隔离、跨平台 | 需要安装 Docker |
| **🥉 手动部署** | ⭐⭐⭐ 中等 | 定制化需求 | 完全可控 | 步骤繁琐 |

---

## 🚀 方案一：一键安装脚本（推荐新手）

### 特点
- ✅ **最简单**：双击运行，自动完成所有安装
- ✅ **零配置**：自动检测环境、安装依赖
- ✅ **跨平台**：Windows、Linux、macOS 都支持
- ✅ **智能检测**：自动检查 Python、pip 等

### 使用步骤

#### Windows 用户
```powershell
# 1. 双击运行
一键安装.bat

# 2. 等待安装完成（约 3-5 分钟）

# 3. 配置 Cookie（重要！）
notepad .env
# 粘贴你的闲鱼 Cookie 到 XIANYU_COOKIE=

# 4. 启动系统
双击 "启动系统.bat"

# 5. 访问系统
# 浏览器自动打开 http://127.0.0.1:8000
```

#### Linux/macOS 用户
```bash
# 1. 运行安装脚本
bash 一键安装.sh

# 2. 等待安装完成（约 3-5 分钟）

# 3. 配置 Cookie（重要！）
nano .env
# 粘贴你的闲鱼 Cookie 到 XIANYU_COOKIE=

# 4. 启动系统
bash 启动系统.sh

# 5. 访问系统
# 浏览器打开 http://127.0.0.1:8000
```

### 自动化内容
脚本会自动完成：
- ✅ 检测 Python 版本
- ✅ 安装/升级 pip
- ✅ 安装所有 Python 依赖包
- ✅ 安装 Playwright 浏览器驱动
- ✅ 创建 .env 配置文件
- ✅ 创建必要的目录结构
- ✅ 配置国内镜像源加速下载

---

## 🐳 方案二：Docker 容器（推荐服务器）

### 特点
- ✅ **环境隔离**：不影响系统环境
- ✅ **跨平台**：Windows、Linux、macOS 完全一致
- ✅ **易于维护**：一键启动、停止、更新
- ✅ **版本管理**：方便回滚和升级

### 使用步骤

#### 前置要求
```bash
# 安装 Docker
# Windows: 下载 Docker Desktop
#   https://www.docker.com/products/docker-desktop

# Linux:
#   curl -fsSL https://get.docker.com | sh

# macOS:
#   brew install --cask docker
```

#### 启动系统
```bash
# 1. 配置 .env 文件
cp .env.example .env
nano .env  # 修改 XIANYU_COOKIE 等配置

# 2. 构建并启动容器
docker-compose up -d

# 3. 查看日志
docker-compose logs -f

# 4. 访问系统
# http://127.0.0.1:8000
```

#### 常用命令
```bash
# 启动
docker-compose up -d

# 停止
docker-compose down

# 重启
docker-compose restart

# 查看日志
docker-compose logs -f

# 进入容器
docker-compose exec xianyu-crawler bash

# 更新代码后重新构建
docker-compose up -d --build
```

### Docker 优势
- 🔒 **环境隔离**：不会影响系统 Python 环境
- 📦 **一键部署**：无需手动安装依赖
- 🔄 **易于迁移**：导出镜像可在任何地方运行
- 📊 **资源管理**：方便限制 CPU、内存使用

---

## 🛠️ 方案三：手动部署（适合定制需求）

### 适用场景
- 需要定制化配置
- 学习系统工作原理
- 特殊网络环境

### 基本步骤
```bash
# 1. 安装 Python 3.9+
# (自行安装)

# 2. 安装依赖
pip install -r requirements.txt

# 3. 安装浏览器驱动
playwright install chromium

# 4. 配置环境
cp .env.example .env
nano .env

# 5. 启动
python web_server.py
```

详细步骤请参考 `DEPLOYMENT_GUIDE.md`

---

## 📊 方案选择建议

### 根据场景选择

#### 场景 1: 个人电脑快速体验
→ **推荐：一键安装脚本**
```powershell
# Windows
双击 "一键安装.bat"

# Linux/macOS
bash 一键安装.sh
```

#### 场景 2: 服务器长期运行
→ **推荐：Docker 容器**
```bash
docker-compose up -d
```

#### 场景 3: 开发调试
→ **推荐：手动部署 + 虚拟环境**
```bash
python3 -m venv venv
source venv/bin/activate  # Linux/macOS
# 或 venv\Scripts\activate  # Windows
pip install -r requirements.txt
python web_server.py
```

#### 场景 4: 多台机器部署
→ **推荐：打包脚本 + 一键安装**
```powershell
# 1. 在配置好的机器上打包
双击 "打包部署.bat"

# 2. 复制到其他机器
# 3. 在新机器上运行一键安装
双击 "一键安装.bat"
```

---

## 🎓 新手推荐流程

### 第一次使用（最快 5 分钟上手）

```powershell
# Windows 用户（推荐）
1. 双击 "一键安装.bat"
2. 等待 3-5 分钟自动安装
3. 配置 Cookie: notepad .env
4. 双击 "启动系统.bat"
5. 浏览器自动打开，开始使用！

# Linux/macOS 用户
1. bash 一键安装.sh
2. nano .env  # 配置 Cookie
3. bash 启动系统.sh
4. 浏览器打开 http://127.0.0.1:8000
```

### 服务器部署（推荐 Docker）

```bash
1. 安装 Docker
2. 配置 .env 文件
3. docker-compose up -d
4. 完成！
```

---

## 🔧 常用操作

### 启动系统

| 方式 | 命令 |
|------|------|
| Windows 双击 | `启动系统.bat` |
| Linux/macOS 脚本 | `bash 启动系统.sh` |
| 直接运行 | `python web_server.py` |
| Docker | `docker-compose up -d` |

### 停止系统

| 方式 | 命令 |
|------|------|
| Windows 双击 | `停止系统.bat` |
| Linux/macOS 脚本 | `bash 停止系统.sh` |
| Docker | `docker-compose down` |

### 查看日志

| 方式 | 命令 |
|------|------|
| Web 界面 | 点击 "查看日志" 按钮 |
| 命令行 | `tail -f logs/task_1_*.log` |
| Docker | `docker-compose logs -f` |

---

## 💡 部署技巧

### 1. 使用国内镜像加速
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### 2. 后台运行（Linux）
```bash
nohup python web_server.py > server.log 2>&1 &
```

### 3. 开机自启动（systemd）
```bash
# 创建服务文件
sudo nano /etc/systemd/system/xianyu-crawler.service

# 启用服务
sudo systemctl enable xianyu-crawler
sudo systemctl start xianyu-crawler
```

### 4. 端口转发（远程访问）
```bash
# SSH 隧道
ssh -L 8000:localhost:8000 user@server

# 或使用 frp/ngrok 等工具
```

---

## ❓ 常见问题

### Q1: 一键安装脚本失败？
**A:**
1. 确认 Python 已安装：`python --version`
2. 以管理员身份运行脚本
3. 检查网络连接

### Q2: Docker 构建失败？
**A:**
1. 确认 Docker 已安装：`docker --version`
2. 检查磁盘空间
3. 使用国内镜像源

### Q3: Cookie 配置后仍无法登录？
**A:**
1. 重新获取 Cookie（可能过期）
2. 确认复制了完整的 Cookie 值
3. 首次运行设置 `RUN_HEADLESS=false` 观察

### Q4: 端口被占用？
**A:**
1. 运行 "停止系统" 脚本
2. 或修改 .env 中的 `SERVER_PORT=8001`

---

## 📞 获取帮助

- **快速入门**: `QUICKSTART.md`
- **完整文档**: `DEPLOYMENT_GUIDE.md`
- **Cookie 说明**: `COOKIE使用说明.md`
- **项目总结**: `PROJECT_SUMMARY.md`

---

## 🎉 总结

| 如果你是... | 推荐使用... |
|------------|------------|
| 新手、第一次使用 | 🥇 一键安装脚本 |
| 服务器部署 | 🥇 Docker 容器 |
| 开发者、需要定制 | 🥈 手动部署 + venv |
| 批量部署 | 🥈 打包脚本 + 一键安装 |

**最简单的方式**：
- Windows: 双击 `一键安装.bat` → 双击 `启动系统.bat` → 完成！
- Linux/macOS: `bash 一键安装.sh` → `bash 启动系统.sh` → 完成！

开始使用吧！🚀
